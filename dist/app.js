"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t);var s=Object.getOwnPropertyDescriptor(r,t);s&&("get"in s?r.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,i,s)}:function(e,r,t,i){e[i=void 0===i?t:i]=r[t]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&__createBinding(r,e,t);return __setModuleDefault(r,e),r},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},fastify=(Object.defineProperty(exports,"__esModule",{value:!0}),__importStar(require("fastify"))),express=require("express"),path=__importStar(require("path")),multer=require("fastify-multer"),envPath=path.join(__dirname,"./.env"),packageJSON=(require("dotenv").config({path:envPath}),require("../package.json")),router_1=__importDefault(require("./router/router")),app=fastify.fastify({logger:{level:"info"}});app.register(multer.contentParser),app.register(require("fastify-cors"),{origin:"*",credentials:"true",preflightContinue:!0,optionsSuccessStatus:200,allowedHeaders:"*",methods:"GET,POST,OPTIONS,PUT,DELETE,PATCH"}),app.register(require("@fastify/formbody")),app.register(require("./plugins/mysqldb"),{options:{client:"mysql2",connection:{host:process.env.DB_HOST,port:Number(process.env.DB_PORT),user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME},debug:!0},pool:{min:0,max:7},connectionName:"db"}),app.register(require("./plugins/jwt"),{secret:process.env.JWT_SECRET||"@0955#@#@"}),app.register(require("fastify-static"),{root:path.join(__dirname,"../public"),prefix:"/assets/"}),app.register(require("point-of-view"),{engine:{ejs:require("ejs"),root:path.join(__dirname,"../views")},includeViewExtension:!0}),app.register(require("./plugins/typeorm"),{options:{client:"mysql",entities:"../entities/*{.ts,.js}",migrations:"../migration/*{.ts,.js}",subscribers:"../subscriber/*{.ts,.js}",connection:{host:process.env.DB_HOST,port:Number(process.env.DB_PORT),user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME},debug:!0},connectionName:"db"}),app.register(router_1.default,{prefix:"".concat(packageJSON.endPoint)}),exports.default=app;